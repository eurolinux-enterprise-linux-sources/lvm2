commit 2cc05ab5a48a81b7daf4849aefb6864ad096d73f
Author: Peter Rajnoha <prajnoha@redhat.com>
Date:   Wed Apr 15 12:49:10 2015 +0200

    Set correct vgid when writing PV metadata
---
 WHATS_NEW                     |  1 +
 lib/format_text/format-text.c | 11 ++++++-----
 2 files changed, 7 insertions(+), 5 deletions(-)

diff --git a/WHATS_NEW b/WHATS_NEW
index e84dc91..c28042b 100644
--- a/WHATS_NEW
+++ b/WHATS_NEW
@@ -1,5 +1,6 @@
 Version 2.02.119 - 
 ==================================
+  Set correct vgid when updating cache when writing PV metadata.
   Don't silently accept lvcreate -m with raid4/5/6.
   Respect allocation/cling_tag_list during intial contiguous allocation.
   Add A_PARTITION_BY_TAGS set when allocated areas should not share tags.
diff --git a/lib/format_text/format-text.c b/lib/format_text/format-text.c
index bdac7f9..4934d51 100644
--- a/lib/format_text/format-text.c
+++ b/lib/format_text/format-text.c
@@ -1318,7 +1318,7 @@ static int _write_single_mda(struct metadata_area *mda, void *baton)
 	return 1;
 }
 
-/* Only for orphans */
+/* Only for orphans - FIXME That's not true any more */
 static int _text_pv_write(const struct format_type *fmt, struct physical_volume *pv)
 {
 	struct format_instance *fid = pv->fid;
@@ -1330,10 +1330,11 @@ static int _text_pv_write(const struct format_type *fmt, struct physical_volume
 	struct _write_single_mda_baton baton;
 	unsigned mda_index;
 
-	/* Add a new cache entry with PV info or update existing one. */
-	if (!(info = lvmcache_add(fmt->labeller, (const char *) &pv->id,
-				  pv->dev, pv->vg_name, NULL, 0)))
-		return_0;
+        /* Add a new cache entry with PV info or update existing one. */
+        if (!(info = lvmcache_add(fmt->labeller, (const char *) &pv->id,
+                                  pv->dev, pv->vg_name,
+                                  is_orphan_vg(pv->vg_name) ? pv->vg_name : pv->vg ? (const char *) &pv->vg->id : NULL, 0)))
+                return_0;
 
 	label = lvmcache_get_label(info);
 	label->sector = pv->label_sector;
